# pyHadith
pyHadith is a python package which automatically segments and categorizes ahadith.

The package works by feeding raw text to custom natural language processing (NLP) models and algorithms. The resulting data is the aggregated and returned in a standardized format.

## 1. How It Works
### 1.1. Statistical Natural Language Processing Models
pyHadith uses two statistical natural language processing (NLP) models to extract narrators from, and categorize (i.e. [athar](https://en.wikipedia.org/wiki/Hadith#Distinction_from_other_literature), [khabar](https://en.wikipedia.org/wiki/Hadith#Distinction_from_other_literature)), ahadith. These are: a Named Entity Recognition (NER) model, known as *rawa*; and, a Text Classification model, known as *asl*. All of these models were combined into a single model known as *ahadith*.

The models were trained on manually annotated ahadith by the Saudi Arabian *[Permanent Committee for Scholarly Research and Ifta](https://sunnah.alifta.gov.sa/)*. Due to copyright, the data used to train the models cannot be reproduced. The models themselves, however, are not copyrighted (except under our own GNU GPLv3 license) as they come under the fair use doctrine.

The models were generated by [spaCy](https://spacy.io/) version 2.2.4. The training corpus contained 29,288 annotated ahadith, taken from [sunnah.alifta.gov.sa](https://sunnah.alifta.gov.sa/). 5,784 ahadith were withheld and used for evaluating models. After training models for 100 iterations, the best performing models were selected.

The results of the final models are displayed in the table below:

| Model | Model Type | Precision | Recall | F-Score |
|--|--|--|--|--|
| Rawa  | Named Entity Recognition | 98.96 | 98.91 | 98.94 |
| Asl   | Text Classification |  |  | 97.78 |

### 1.2. Asnad Reconstruction Algorithm
To ensure that the names extracted by the *rawa* model are accurate, and to also identify the relationships of such narrators, a custom asnad reconstruction algorithm is employed.

A pre-processor first uses [Motaz Saad](https://github.com/motazsaad)'s '[split-waw-arabic](https://github.com/motazsaad/split-waw-arabic)' method to identify and add whitespaces after the word 'وَ.'

The algorithm then post-processes the data returned by the *ahadith* model. It first assumes that the matn begins at the last occurance of a narrator's name. The terms joining narrators are then standardized. There are two possible relationships recognized by the algorithm: A **from** B, and, A **from** B **and** C. Thus, where a term joins two or more narrators to a single narratee, that narratee will have multiple 'parent' narrators.

Finally, to deal with misassignments by the *rawa* model, a set of common joining terms is used to ensure that a narrator's name is not, or does not contain, a joining term.

## 2. Installation
pyHadith is available on pip. You can install pyHadith using the following command:

    pip install pyHadith

The following python packages will also be automatically installed as dependencies of pyHadith:

| Package | Version | Description |
|--|--|--|
| [spaCy](https://github.com/explosion/spaCy) | 2.2.4 | Used to interact with the *ahadith* model.
| [pyArabic](https://github.com/linuxscout/pyarabic) | >= 0.6.7 | Used to remove diacritics from arabic strings.
| [nltk](https://github.com/nltk/nltk) | >= 3.4.5 | Used to tokenize arabic strings.

## 3. Usage
### 3.1. Import pyHadith
The first step in using pyHadith is to import the package to your code. You can do so with the following line:

    # Import the pyHadith package.
    import pyHadith

### 3.2. Deconstruct a Hadith
To deconstruct a hadith, you must first create a 'hadith' object with the hadith module. This requires the passing of a single argument, a UTF-8 encoded Arabic text with diacritics.

The code below demonstrates how a 'hadith' object can be created:

    # -*- coding: utf-8 -*-
    # Import the 'hadith' module of pyHadith.
    import pyhadith.hadith as hadith
    # Set the hadith to be processed.
    text = u'حَدَّثَنِي يَحْيَى، عَنْ مَالِكٍ، أَنَّهُ بَلَغَهُ أَنَّ سَعِيدَ بْنَ الْمُسَيَّبِ، وَسُلَيْمَانَ بْنَ يَسَارٍ، كَانَا يَقُولاَنِ عِدَّةُ الأَمَةِ إِذَا هَلَكَ عَنْهَا زَوْجُهَا شَهْرَانِ وَخَمْسُ لَيَالٍ ‏.‏'
    # Create a hadith object using the text of the hadith.
    x = hadith.Hadith(text)
    # Print the resulting attributes.
    print({
    "raw" : x.raw,
    "clean" : x.clean,
    "matn" : x.matn,
    "isnad" : x.isnad,
    "category" : x.category
    })

Once a hadith object is created, the following attributes will become available:

| Attribute | Data Type | Description |
|--|--|--|
| raw | String | The original raw text. |
| clean | String | The cleaned raw text. |
| matn | Object | An object containing the 'raw' text, 'start_char' index (in the cleaned text), and 'end_char' index (in the cleaned text), of the matn. |
| isnad | Object | An object containing the 'raw' text, 'start_char' index (in the cleaned text), and 'end_char' index (in the cleaned text), of the isnad, along with a 'narrators' list which contains narrator objects (discussed later). |
| category | Object | An object containing the 'label' (either 'athar' or 'khabar') and 'score' (from .5 to 1) of the assigned category. |

A 'narrator' object in the 'narrators' list will contain the following attributes:

| Attribute | Data Type | Description |
|--|--|--|
| id | Integer | A unique identifier number. |
| name | String | The raw text of the narrator's name. |
| start_char | Integer | The character index in the cleaned text where the name begins. |
| end_char | Integer | The character index in the cleaned text where the name ends. |
| parents | List | A list of the ids of the narrator's parents within the isnad. |

## 4. License
pyHadith is licensed under [GPLv3](https://github.com/umarbutler/pyhadith/blob/master/LICENSE). pyArabic, spaCy and NLTK are licensed under [GPLv3](https://github.com/linuxscout/pyarabic/blob/master/LICENSE), [MIT](https://github.com/explosion/spaCy/blob/master/LICENSE), and [Apache 2.0](https://github.com/nltk/nltk/blob/develop/LICENSE.txt), respectively. These licenses are all GPL compatible.
